<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patta Upload - Volunteer Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .upload-area {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .upload-area.dragover {
            border-color: #10b981;
            background-color: #ecfdf5;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .camera-preview {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .floating-card {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .floating-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Header -->
    <header class="glass-effect text-white py-4 px-6">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                    <i data-lucide="file-text" class="w-6 h-6 text-indigo-600"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Patta Upload Portal</h1>
                    <p class="text-sm opacity-90">Volunteer Document Upload System</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-right">
                    <p class="text-sm font-medium">Welcome, Volunteer</p>
                    <p class="text-xs opacity-75">Session Active</p>
                </div>
                <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                    <i data-lucide="user" class="w-5 h-5 text-indigo-600"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="glass-effect rounded-xl p-6 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90">Total Uploaded</p>
                        <p class="text-2xl font-bold" id="totalUploaded">0</p>
                    </div>
                    <i data-lucide="upload" class="w-8 h-8 opacity-75"></i>
                </div>
            </div>
            <div class="glass-effect rounded-xl p-6 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90">Pending Review</p>
                        <p class="text-2xl font-bold" id="pendingReview">0</p>
                    </div>
                    <i data-lucide="clock" class="w-8 h-8 opacity-75"></i>
                </div>
            </div>
            <div class="glass-effect rounded-xl p-6 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90">Approved</p>
                        <p class="text-2xl font-bold" id="approved">0</p>
                    </div>
                    <i data-lucide="check-circle" class="w-8 h-8 opacity-75"></i>
                </div>
            </div>
            <div class="glass-effect rounded-xl p-6 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90">Today's Uploads</p>
                        <p class="text-2xl font-bold" id="todayUploads">0</p>
                    </div>
                    <i data-lucide="calendar" class="w-8 h-8 opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Camera Upload -->
            <div class="floating-card bg-white rounded-2xl p-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="camera" class="w-8 h-8 text-blue-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Camera Upload</h2>
                    <p class="text-gray-600">Capture patta documents directly using your device camera</p>
                </div>

                <!-- Camera Preview -->
                <div class="camera-preview mb-6 bg-gray-100 aspect-video flex items-center justify-center" id="cameraPreview">
                    <div class="text-center">
                        <i data-lucide="camera" class="w-12 h-12 text-gray-400 mx-auto mb-2"></i>
                        <p class="text-gray-500">Camera preview will appear here</p>
                    </div>
                </div>

                <!-- Camera Controls -->
                <div class="space-y-4">
                    <button id="startCamera" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2">
                        <i data-lucide="video" class="w-5 h-5"></i>
                        <span>Start Camera</span>
                    </button>
                    
                    <div id="cameraControls" class="hidden space-y-3">
                        <button id="capturePhoto" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2">
                            <i data-lucide="camera" class="w-5 h-5"></i>
                            <span>Capture Photo</span>
                        </button>
                        
                        <button id="stopCamera" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2">
                            <i data-lucide="video-off" class="w-5 h-5"></i>
                            <span>Stop Camera</span>
                        </button>
                    </div>

                    <!-- Captured Image Preview -->
                    <div id="capturedImageContainer" class="hidden">
                        <div class="border-2 border-green-300 rounded-lg p-4 bg-green-50">
                            <div class="flex items-center space-x-2 mb-3">
                                <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                                <span class="text-green-800 font-medium">Photo Captured Successfully!</span>
                            </div>
                            <img id="capturedImage" class="w-full rounded-lg mb-3" alt="Captured patta">
                            <div class="flex space-x-2">
                                <button id="retakePhoto" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Retake
                                </button>
                                <button id="useCapturedPhoto" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Use This Photo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Upload -->
            <div class="floating-card bg-white rounded-2xl p-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="upload" class="w-8 h-8 text-purple-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">File Upload</h2>
                    <p class="text-gray-600">Upload patta documents from your device storage</p>
                </div>

                <!-- Upload Area -->
                <div class="upload-area rounded-xl p-8 text-center mb-6" id="uploadArea">
                    <div class="space-y-4">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto">
                            <i data-lucide="upload" class="w-8 h-8 text-gray-400"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Drop files here or click to browse</h3>
                            <p class="text-gray-600 mb-4">Supports: JPG, PNG, PDF (Max 10MB each)</p>
                            <button id="browseFiles" class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-6 rounded-lg font-medium transition-colors">
                                Browse Files
                            </button>
                        </div>
                    </div>
                </div>

                <!-- File Input -->
                <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.png,.pdf" class="hidden">

                <!-- Uploaded Files List -->
                <div id="uploadedFilesList" class="space-y-3"></div>
            </div>
        </div>

        <!-- Document Details Form -->
        <div class="floating-card bg-white rounded-2xl p-8 mt-8" id="documentDetailsForm">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="file-text" class="w-8 h-8 text-green-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Document Details</h2>
                <p class="text-gray-600">Provide additional information about the uploaded patta</p>
            </div>

            <form id="pattaForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Beneficiary Name *</label>
                        <input type="text" id="beneficiaryName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter beneficiary name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Aadhaar Number *</label>
                        <input type="text" id="aadhaarNumber" required pattern="[0-9]{4}-[0-9]{4}-[0-9]{4}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="1234-5678-9012">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Village *</label>
                        <select id="village" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select Village</option>
                            <option value="चिरमिरी">चिरमिरी</option>
                            <option value="पाकाला">पाकाला</option>
                            <option value="चंबा">चंबा</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Document Type *</label>
                        <select id="documentType" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select Document Type</option>
                            <option value="Land Deed">Land Deed</option>
                            <option value="Patta Document">Patta Document</option>
                            <option value="Identity Proof">Identity Proof</option>
                            <option value="Community Consent">Community Consent</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Additional Notes</label>
                    <textarea id="notes" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Any additional information about this document..."></textarea>
                </div>

                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelUpload" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" id="submitUpload" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors flex items-center space-x-2">
                        <i data-lucide="upload" class="w-5 h-5"></i>
                        <span>Upload Patta</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Recent Uploads -->
        <div class="floating-card bg-white rounded-2xl p-8 mt-8">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="history" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">Recent Uploads</h2>
                        <p class="text-gray-600">Your recent patta uploads and their status</p>
                    </div>
                </div>
                <button id="refreshUploads" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    <span>Refresh</span>
                </button>
            </div>

            <div id="recentUploadsList" class="space-y-4">
                <!-- Recent uploads will be populated here -->
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 success-animation">
                <i data-lucide="check" class="w-8 h-8 text-green-600"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Upload Successful!</h3>
            <p class="text-gray-600 mb-6">Your patta document has been uploaded and is pending review.</p>
            <button id="closeSuccessModal" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                Continue
            </button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 pulse-animation">
                <i data-lucide="loader-2" class="w-8 h-8 text-blue-600 animate-spin"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Uploading...</h3>
            <p class="text-gray-600">Please wait while we process your document.</p>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let stream = null;
        let capturedImageData = null;
        let uploadedFiles = [];
        let totalUploads = 0;

        // Mock data for demonstration
        const mockRecentUploads = [
            {
                id: 1,
                beneficiaryName: "राम सिंह",
                village: "चिरमिरी",
                documentType: "Patta Document",
                uploadDate: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
                status: "Pending Review",
                fileName: "patta_ram_singh.pdf"
            },
            {
                id: 2,
                beneficiaryName: "सीता देवी",
                village: "पाकाला",
                documentType: "Land Deed",
                uploadDate: new Date(Date.now() - 5 * 60 * 60 * 1000), // 5 hours ago
                status: "Approved",
                fileName: "land_deed_sita_devi.jpg"
            },
            {
                id: 3,
                beneficiaryName: "मोहन लाल",
                village: "चंबा",
                documentType: "Identity Proof",
                uploadDate: new Date(Date.now() - 24 * 60 * 60 * 1000), // 1 day ago
                status: "Under Review",
                fileName: "id_proof_mohan_lal.png"
            }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeStats();
            setupEventListeners();
            loadRecentUploads();
        });

        function initializeStats() {
            // Update stats with mock data
            document.getElementById('totalUploaded').textContent = '12';
            document.getElementById('pendingReview').textContent = '8';
            document.getElementById('approved').textContent = '4';
            document.getElementById('todayUploads').textContent = '3';
        }

        function setupEventListeners() {
            // Camera controls
            document.getElementById('startCamera').addEventListener('click', startCamera);
            document.getElementById('capturePhoto').addEventListener('click', capturePhoto);
            document.getElementById('stopCamera').addEventListener('click', stopCamera);
            document.getElementById('retakePhoto').addEventListener('click', retakePhoto);
            document.getElementById('useCapturedPhoto').addEventListener('click', useCapturedPhoto);

            // File upload controls
            document.getElementById('browseFiles').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);

            // Upload area drag and drop
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => document.getElementById('fileInput').click());

            // Form submission
            document.getElementById('pattaForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('cancelUpload').addEventListener('click', resetForm);

            // Modal controls
            document.getElementById('closeSuccessModal').addEventListener('click', closeSuccessModal);
            document.getElementById('refreshUploads').addEventListener('click', loadRecentUploads);
        }

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                const video = document.createElement('video');
                video.srcObject = stream;
                video.autoplay = true;
                video.style.width = '100%';
                video.style.height = '100%';
                video.style.objectFit = 'cover';
                
                const preview = document.getElementById('cameraPreview');
                preview.innerHTML = '';
                preview.appendChild(video);
                
                document.getElementById('startCamera').classList.add('hidden');
                document.getElementById('cameraControls').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Unable to access camera. Please check permissions.');
            }
        }

        function capturePhoto() {
            const video = document.querySelector('#cameraPreview video');
            if (!video) return;

            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0);
            
            capturedImageData = canvas.toDataURL('image/jpeg', 0.8);
            
            // Show captured image
            const capturedImage = document.getElementById('capturedImage');
            capturedImage.src = capturedImageData;
            
            document.getElementById('capturedImageContainer').classList.remove('hidden');
            document.getElementById('cameraControls').classList.add('hidden');
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            const preview = document.getElementById('cameraPreview');
            preview.innerHTML = `
                <div class="text-center">
                    <i data-lucide="camera" class="w-12 h-12 text-gray-400 mx-auto mb-2"></i>
                    <p class="text-gray-500">Camera preview will appear here</p>
                </div>
            `;
            lucide.createIcons();
            
            document.getElementById('startCamera').classList.remove('hidden');
            document.getElementById('cameraControls').classList.add('hidden');
            document.getElementById('capturedImageContainer').classList.add('hidden');
        }

        function retakePhoto() {
            document.getElementById('capturedImageContainer').classList.add('hidden');
            document.getElementById('cameraControls').classList.remove('hidden');
        }

        function useCapturedPhoto() {
            // Create a file from the captured image data
            const byteString = atob(capturedImageData.split(',')[1]);
            const mimeString = capturedImageData.split(',')[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            
            const blob = new Blob([ab], { type: mimeString });
            const file = new File([blob], `captured_patta_${Date.now()}.jpg`, { type: mimeString });
            
            uploadedFiles.push(file);
            updateUploadedFilesList();
            
            // Reset camera
            stopCamera();
            capturedImageData = null;
        }

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            uploadedFiles.push(...files);
            updateUploadedFilesList();
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = Array.from(event.dataTransfer.files);
            uploadedFiles.push(...files);
            updateUploadedFilesList();
        }

        function updateUploadedFilesList() {
            const container = document.getElementById('uploadedFilesList');
            
            if (uploadedFiles.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-medium text-blue-800 mb-3">Selected Files (${uploadedFiles.length})</h4>
                    <div class="space-y-2">
                        ${uploadedFiles.map((file, index) => `
                            <div class="flex items-center justify-between bg-white p-3 rounded-lg border">
                                <div class="flex items-center space-x-3">
                                    <i data-lucide="file" class="w-5 h-5 text-blue-600"></i>
                                    <div>
                                        <p class="font-medium text-gray-900">${file.name}</p>
                                        <p class="text-sm text-gray-500">${(file.size / 1024).toFixed(1)} KB</p>
                                    </div>
                                </div>
                                <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="proceedToDetails()" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                        Proceed to Document Details
                    </button>
                </div>
            `;
            
            lucide.createIcons();
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateUploadedFilesList();
        }

        function proceedToDetails() {
            if (uploadedFiles.length === 0 && !capturedImageData) {
                alert('Please upload or capture at least one document.');
                return;
            }
            
            document.getElementById('documentDetailsForm').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function handleFormSubmit(event) {
            event.preventDefault();
            
            if (uploadedFiles.length === 0 && !capturedImageData) {
                alert('Please upload or capture at least one document.');
                return;
            }
            
            const formData = {
                beneficiaryName: document.getElementById('beneficiaryName').value,
                aadhaarNumber: document.getElementById('aadhaarNumber').value,
                village: document.getElementById('village').value,
                documentType: document.getElementById('documentType').value,
                notes: document.getElementById('notes').value,
                files: uploadedFiles,
                capturedImage: capturedImageData
            };
            
            // Show loading overlay
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            // Simulate upload process
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('successModal').classList.remove('hidden');
                
                // Update stats
                totalUploads++;
                document.getElementById('totalUploaded').textContent = totalUploads + 12;
                document.getElementById('todayUploads').textContent = parseInt(document.getElementById('todayUploads').textContent) + 1;
                
                // Create new patta document entry
                const newPattaDocument = {
                    id: `PATA_${Date.now()}`,
                    beneficiaryName: formData.beneficiaryName,
                    aadhaarNumber: formData.aadhaarNumber,
                    village: formData.village,
                    documentType: formData.documentType,
                    uploadDate: new Date(),
                    status: 'Pending Review',
                    fileName: formData.files.length > 0 ? formData.files[0].name : "captured_image.jpg",
                    fileSize: formData.files.length > 0 ? formData.files[0].size : 1024000,
                    fileType: formData.files.length > 0 ? formData.files[0].type : "image/jpeg",
                    volunteerName: "Volunteer User",
                    notes: formData.notes,
                    coordinates: {
                        latitude: 22.220035169973066 + (Math.random() - 0.5) * 0.01,
                        longitude: 80.27602945502146 + (Math.random() - 0.5) * 0.01
                    },
                    gramaSabhaApproved: false,
                    sdlcReviewStatus: 'Pending'
                };
                
                // Save to localStorage for GramaSabha to access
                const existingDocuments = JSON.parse(localStorage.getItem('volunteerUploadedPattas') || '[]');
                existingDocuments.unshift(newPattaDocument);
                localStorage.setItem('volunteerUploadedPattas', JSON.stringify(existingDocuments));
                
                // Debug logging
                console.log('Saved new patta document:', newPattaDocument);
                console.log('All documents in localStorage:', existingDocuments);
                
                // Add to recent uploads for display
                const newUpload = {
                    id: Date.now(),
                    beneficiaryName: formData.beneficiaryName,
                    village: formData.village,
                    documentType: formData.documentType,
                    uploadDate: new Date(),
                    status: "Pending Review",
                    fileName: formData.files.length > 0 ? formData.files[0].name : "captured_image.jpg"
                };
                mockRecentUploads.unshift(newUpload);
                
                resetForm();
            }, 2000);
        }

        function resetForm() {
            document.getElementById('pattaForm').reset();
            uploadedFiles = [];
            capturedImageData = null;
            updateUploadedFilesList();
            document.getElementById('capturedImageContainer').classList.add('hidden');
            stopCamera();
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        function loadRecentUploads() {
            const container = document.getElementById('recentUploadsList');
            
            container.innerHTML = mockRecentUploads.map(upload => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="file-text" class="w-5 h-5 text-blue-600"></i>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900">${upload.beneficiaryName}</h4>
                            <p class="text-sm text-gray-600">${upload.village} • ${upload.documentType}</p>
                            <p class="text-xs text-gray-500">${formatDate(upload.uploadDate)}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusClass(upload.status)}">
                            ${upload.status}
                        </span>
                        <button class="text-blue-600 hover:text-blue-800">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        function getStatusClass(status) {
            switch (status) {
                case 'Approved':
                    return 'bg-green-100 text-green-800';
                case 'Pending Review':
                    return 'bg-yellow-100 text-yellow-800';
                case 'Under Review':
                    return 'bg-blue-100 text-blue-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }

        function formatDate(date) {
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(hours / 24);
            
            if (days > 0) {
                return `${days} day${days > 1 ? 's' : ''} ago`;
            } else if (hours > 0) {
                return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            } else {
                return 'Just now';
            }
        }

        // Make functions globally available
        window.removeFile = removeFile;
        window.proceedToDetails = proceedToDetails;
    </script>
</body>
</html>

